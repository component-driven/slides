import CDTheme from "@component-driven/mdx-deck-theme"; import * as timers from "timers";

export const theme = { ...CDTheme };

<Primary>

# The Good, The Bad, And The Ugly of Design Systems

</Primary>

---

## Andrey Okonetchnikov

UI engineer with experience in both design & development who specializes in interaction design, design systems and modern frontend development. Design System Lead @ Adverity

[@okonetchnikov](https://twitter.com/okonetchnikov)

---

<Secondary>

# My story

</Secondary>

---

## Adverity Design System

1. Ex-FE developer (first introduction of React)
1. Design system guidance and consultant
1. Design system team lead

---

## Adverity Design System

1. 3 products depend on it
1. 30+ Frontend Engineers
1. 5+ UX Designers

---


<Primary imgSrc="/assets/back-disassembled.jpg">

# Design Systems

</Primary>

---

> Design system defines a set of design-related rules as a system of instructions that can be re-used across single or multiple products

---

# Design Systems

- UI & UX consistency
- A common language
- Development speed
- Best practices

---

<Secondary>

## UI & UX consistency

</Secondary>

---

<Figure
    src="/assets/ds-1.png"
    alt="Design Systems Figure 1"
    caption="German vs Austrian governments"
/>

---

<Figure
    src={"/assets/doors.jpg"}
    alt="Different doors"
    caption="No design system in real life"
/>

---

<Figure
    src="/assets/too-many-buttons.jpg"
    alt="Different button styles"
    caption="No design system in a digital product"
/>

---

## Inconsistencies coming from

1. Custom styles
1. Custom UI elements
1. Custom UX for same problems

---

## Custom styles

---

### Using custom CSS in the product

<Grid columns={2} gap={4}>

```css
.description {
    margin-bottom: 20px;
    font-size: 16px;
    color: #c9b8b9;
}
```

```css
.count {
    margin-left: 0.75em;
    font-size: 14px;
    opacity: 0.5;
    color: #fc9;
}
```

</Grid>

---

### The Bad

Using custom styles during design

<Figure
    src="/assets/custom-colors.png"
    alt="Custom colors"
    caption="Custom colors"
/>

---

# Design tokens

---


> Design tokens are everything you use more than once in your styles

---

<Figure
    src="/assets/dls-foundation.png"
    alt="Design Tokens"
    caption="Design Tokens"
/>

---

<Demo src="https://design-system.adverity.net/versions/17.2.0/storybook/?path=/docs/documentation-design-tokens-tokens-list--page" />

---

### Using design tokens

<Grid columns={2} gap={4}>

```css
.description {
    margin-bottom: var(--spacing-sm);
    font-size: var(--fontSize-md);
    color: var(--color-primary);
}
```

```css
.count {
    margin-left: var(--spacing-sm);
    font-size: var(--fontSize-md);
    opacity: var(--opacity-50);
    color: var(--color-accent);
}
```

</Grid>


---

<Demo src="https://jansix.at/resources/figma-tokens" />


---

## Custom UI elements

---

<Figure
    src="/assets/custom-design-radio-figma.png"
    alt="Custom radio buttons"
    caption="Using custom elements in design"
/>

---

<Figure
    src="/assets/custom-styles-in-design.png"
    alt="Custom radio buttons"
    caption="Using custom elements in design"
/>

---

<Primary>

# Components

</Primary>

---

> HTML was designed for documents, not applications!

---

<Grid gap={3} columns={3}>
    <Appear>
        <span>Text, Heading</span>
        <div>
            <Code language="html">{`<h1>Heading</h1>
<p>Text</p>`}</Code>
        </div>
        <span>Ô∏èüòä</span>
        <span>Link</span>
        <div>
            <Code language="html">{`<a href="#">Link</a>`}</Code>
        </div>
        <span>ü§î</span>
        <span>Button</span>
        <div>
            <Code language="html">
                {`<button type="button">Button</button>
<input type="button" value="Button"/>`}
            </Code>
        </div>
        <span>üôÑ</span>
        <span>Dropdown</span>
        <div sx={{ maxHeight: "50%" }}>
            <Code language="html">
                {`<div class="dropdown">
    <button
      class="btn btn-default dropdown-toggle"
      type="button"
      id="dropdownMenu1"
      data-toggle="dropdown"
    >
      Dropdown <span class="caret"></span>
    </button>
    <ul class="dropdown-menu">
      <li><a href="#">Action</a></li>
      <li><a href="#">Another action</a></li>
      <li><a href="#">Something else here</a></li>
      <li role="separator" class="divider"></li>
      <li><a href="#">Separated link</a></li>
    </ul>
  </div>`}
            </Code>
        </div>
        <span>üò©</span>
    </Appear>
</Grid>

---

<Figure
    src={"/assets/bootstrap-dropdown.png"}
    alt="Bootstrap Documentation Screenshot"
    caption={
        <a href="https://getbootstrap.com/docs/3.3/components/#dropdowns">
            https://getbootstrap.com/docs/3.3/components/#dropdowns
        </a>
    }
/>

<ThatGuy />

---

# Components

- `<Button>` ‚Üí `<button>`
- `<Input>` ‚Üí `<input type="text">`
- `<Checkbox>` ‚Üí `<input type="checkbox">`
- `<Dropdown>` ‚Üí ~~`<select>`~~ `<div class="dropdown">...`

---

> Components is a better way of writing HTML

---

```html
<div class="dropdown">
  <button
    class="btn btn-default dropdown-toggle"
    type="button"
    id="dropdownMenu1"
    data-toggle="dropdown"
    aria-haspopup="true"
    aria-expanded=‚Äútrue"
  >
    Dropdown
    <span class="caret"></span>
  </button>
  <ul
     class="dropdown-menu"
     aria-labelledby=‚ÄúdropdownMenu1"
  >
    <li><a href="#">Action</a></li>
    <li><a href="#">Another action</a></li>
    <li role="separator" class="divider"></li>
    <li><a href="#">Separated link</a></li>
  </ul>
</div>
```

---

```jsx
<DropdownMenu trigger={<Button>Open Dropdown</Button>}>
  <DropdownMenuItem>Action</DropdownMenuItem>
  <DropdownMenuItem>Another action</DropdownMenuItem>
  <DropdownMenuSeparator />
  <DropdownMenuItem href="#">Separated link</DropdownMenuItem>
</DropdownMenu>
```

---

> Components can change over time

---

```jsx
const Dropdown = (props) => (
  <select>
    {props.options.map((option) => (
      <option>{option}</option>
    ))}
  </select>
);
```

---

```jsx
const Dropdown = (props) => (
  <div className="dropdown">
    <button class="btn btn-dropdown">{props.button}</button>
    <ul>
      {props.options.map((option) => (
        <li>{option}</li>
      ))}
    </ul>
  </div>
);
```

---

> Components is a common UI language

---

<Grid gap={5} columns={2}>
    <span>A button</span>
    <Code language="jsx">{`<Button>`}</Code>
    <span>A primary button</span>
    <Code language="jsx">{`<Button primary>`}</Code>
    <span>A cheked checkbox</span>
    <Code language="jsx">{`<Checkbox checked>`}</Code>
    <span>A dropdown menu</span>
    <Code language="jsx">{`<DropdownMenu>`}</Code>
</Grid>

---

<Primary imgSrc="/assets/legos.jpg">

# Primitive components

</Primary>

---

> Primitives are the building blocks of the user interface.

---

<Figure
    src={"/assets/legos-assembled.jpg"}
    alt="Lego cars"
    caption="Different items from the same set of bricks"
/>

---

<Primary>

# Primitives Composition

</Primary>

---

## API: Composition

- `<Heading>` ‚Üí `<Text textStyle="heading" as="h1">`
- `<Label>` ‚Üí `<Text textStyle="label" as="label">`
- `<Error>` ‚Üí `<Text color="error" as="p">`

---

> Primitives are meant to be composed

---


<Demo src="https://interplayapp.com/" />

---

## Custom UX for same problems

---

<Figure
    src="/assets/patterns-1.png"
    alt="Custom UI & UX Patterns"
    caption="Different date range pickers"
/>

---

<Figure
    src="/assets/patterns-2.png"
    alt="Custom UI & UX Patterns"
    caption="Different date range pickers"
/>

---

<Figure
    src="/assets/patterns-3.png"
    alt="Custom UI & UX Patterns"
    caption="Different date range pickers"
/>

---

<Figure
    src="/assets/patterns-4.png"
    alt="Custom UI & UX Patterns"
    caption="Different date range pickers"
/>

---

<Primary>

# UI Patterns

</Primary>

---

> A design pattern is the re-usable form of a solution to a design problem.

---

## API: Patterns

- `<Card>` ‚Üí `<Stack>...</Stack>`
- `<ProductCard>` ‚Üí `<Card>...</Card>`
- `<ProductPage>` ‚Üí `products.map(product => <ProductCard product={product} />)`

---

<Demo src="https://design-system.adverity.net/versions/17.6.17/storybook/?path=/docs/documentation-components-pattern-stepper-stepper-docs--page" />

---

<Demo src="https://design-system.adverity.net/versions/17.6.17/storybook/?path=/docs/documentation-components-pattern-autherrorpage-autherrorpage-docs--page" />

---

<Demo src="https://design-system.adverity.net/versions/17.6.17/storybook/?path=/docs/documentation-components-pattern-modaldialog-deletedialog-docs--page" />

---

> UI patterns should be created in the product and shared only if there is a need.

---

# Recap

---

# Design Systems

- UI & UX consistency
- A common language
- Development speed
- Best practices

---

<Primary>

# Lessons learned

</Primary>

---

## Problems

1. Design system is the single source of failure. No QA tools, no tests, regressions happen in products.
2. No release process. Breaking changes can take days to upgrade.
3. Design is often out of sync with design system.
4. Lack of the documentation and guidelines. Developers don't know how use design system properly. Principles > Questions. This means, if I ever have a question, I'd need to establish a principle that answers / explains it.

---

## A single source of truth

---

## A single source of ~~truth~~ failure

---

## A single source of ~~truth~~ failure

1. No types, 100% JavaScript
1. Little to no component tests
1. CSS changes -> regressions in products
1. Hard to test changes manually
1. Writing long "how to test" instructions

---

// TODO: Gif of zombies crawling on the wall

---

## Why invest into tests?

1. Quality
1. Confidence
1. Speed
1. Specification

---

<TweetEmbed id="1381633331230601221" />

---

## What kind of tests?

1. Unit
1. Visual
1. Behavior

---

## Testing strategies

1. JavaScript -> TypeScript
1. Principles -> Unit tests
1. Visual -> Visual regression tests
1. Behavior -> Model based tests
1. Manual QA

---

> Best tests are no tests

---

# JavaScript -> TypeScript

---

### JavaScript -> TypeScript

1. Refactoring a JS file? Convert to TS first!
1. JS -> TS _might be_ a breaking change

---

### Unit tests

1. General rules and principles
1. Utility (pure) functions

---

### General rules and principles

- Pass down valid HTML attributes to DOM
- Allow setting underlying HTML tag with `as`
- Merge `css`, `style`, and `className` props
- Always pass the `ref` with `forwardRef`
- Merge inernal and external refs
- Merge event handlers
- No outer white space (`margin: 0`)

---

```javascript
describe('Ref Tests', () => {
    getComponents(components)
        .filter((component) => !excluded.includes(component.displayName))
        .forEach((Component) => {
            const ref = React.createRef()
            const { container } = render(<Component ref={ref} />)

            test(`${Component.displayName} ref is of "Element" instance`, () => {
                expect(ref.current).toBeInstanceOf(Element)
            })

            if (!excludedFromRootRefTestOnly.includes(Component.displayName)) {
                test(`${Component.displayName} ref goes to the root element`, () => {
                    expect(ref.current).toBe(container.firstChild)
                })
            }
        })
})
```

---

## Visual regressions

---

// TODO: A church with weird windows illustration

---

<Figure
    src={"/assets/tests-visual-snapshot.png"}
    alt="Snapshot tests"
    caption="Snapshot tests"
/>

---

<Figure
    src={"/assets/tests-visual-snapshot-diff.png"}
    alt="Snapshots diff"
    caption="Snapshots diff"
/>

---

<Figure
    src={"/assets/tests-visual-snapshot-visual.png"}
    alt="Visual diff"
    caption="Visual diff"
/>

---

> Visual diff > Snapshot diff

---

<Figure
    src={"/assets/tests-visual-gh.png"}
    alt="Visual tests on GitHub"
    caption="Visual tests on GitHub"
/>

---

<Figure
    src={"/assets/chromatic-checks.png"}
    alt="GitHub PR checks"
    caption="Visual regressions checks in the PR"
/>

---

<Figure
    src={"/assets/chromatic-build.png"}
    alt="Chromatic Build"
    caption="Chromatic Build"
/>

---

<Figure
    src={"/assets/chromatic-ui.png"}
    alt="Chromatic UI Review"
    caption="Chromatic UI Review"
/>

---

## Challenges

1. How to ensure all possible states are covered?
1. How to test pseudo-states?
1. How to test interactive components?

---

## Interactivity & Behavior Tests

1. Manually
1. Automated
1. ???

---

<Figure
    src={"/assets/tests-manual-how-to-test.png"}
    alt="Testing instructions"
    caption="Testing instructions for a Select component"
/>

---

## Manual QA

1. No QA team
1. Atomic Deploy Previews

---

# Release management

---

> No release process. Breaking changes can take days to upgrade.

---

1. Versioning
1. Release automation

---

# **Sem**amtic **Ver**sioning

---

# **SemVer**

---

<Grid columns={3} gap={4}>
    <Box sx={{textAlign:"center"}}>
        <Text style={{fontSize: "5ch"}}>0</Text>
        <Text style={{textDecoration: "line-through"}}>Major</Text>
        <Text>Breaking</Text>
    </Box>
    <Box sx={{textAlign:"center"}}>
        <Text style={{fontSize: "5ch"}}>0</Text>
        <Text style={{textDecoration: "line-through"}}>Minor</Text>
        <Text>New</Text>
    </Box>
    <Box sx={{textAlign:"center"}}>
        <Text style={{fontSize: "5ch"}}>0</Text>
        <Text style={{textDecoration: "line-through"}}>Patch</Text>
        <Text>Fix</Text>
    </Box>
</Grid>

---

<Grid columns={3} gap={4}>
    <Box sx={{textAlign:"center"}}>
        <Text style={{fontSize: "5ch"}}>0</Text>
        <Text style={{textDecoration: "line-through"}}>Major</Text>
        <Text>Breaking</Text>
    </Box>
    <Box sx={{textAlign:"center"}}>
        <Text style={{fontSize: "5ch"}}>0</Text>
        <Text style={{textDecoration: "line-through"}}>Minor</Text>
        <Text>New</Text>
    </Box>
    <Box sx={{textAlign:"center"}}>
        <Text style={{fontSize: "5ch"}}>1</Text>
        <Text style={{textDecoration: "line-through"}}>Patch</Text>
        <Text>Fix</Text>
    </Box>
</Grid>

---

<Grid columns={3} gap={4}>
    <Box sx={{textAlign:"center"}}>
        <Text style={{fontSize: "5ch"}}>0</Text>
        <Text style={{textDecoration: "line-through"}}>Major</Text>
        <Text>Breaking</Text>
    </Box>
    <Box sx={{textAlign:"center"}}>
        <Text style={{fontSize: "5ch"}}>1</Text>
        <Text style={{textDecoration: "line-through"}}>Minor</Text>
        <Text>New</Text>
    </Box>
    <Box sx={{textAlign:"center"}}>
        <Text style={{fontSize: "5ch"}}>1</Text>
        <Text style={{textDecoration: "line-through"}}>Patch</Text>
        <Text>Fix</Text>
    </Box>
</Grid>

---

<Grid columns={3} gap={4}>
    <Box sx={{textAlign:"center"}}>
        <Text style={{fontSize: "5ch"}}>1</Text>
        <Text style={{textDecoration: "line-through"}}>Major</Text>
        <Text>Breaking</Text>
    </Box>
    <Box sx={{textAlign:"center"}}>
        <Text style={{fontSize: "5ch"}}>1</Text>
        <Text style={{textDecoration: "line-through"}}>Minor</Text>
        <Text>New</Text>
    </Box>
    <Box sx={{textAlign:"center"}}>
        <Text style={{fontSize: "5ch"}}>1</Text>
        <Text style={{textDecoration: "line-through"}}>Patch</Text>
        <Text>Fix</Text>
    </Box>
</Grid>

---

<Figure
    src={"/assets/chromatic-1.png"}
    alt="GitHub comments"
    caption="Is CSS change a breaking change?"
/>

---

### Q: Is CSS change a breaking change?

---

# It depends!

---


> If developers might need to change their code, it's a breaking change

---

### How to find out if the code change is needed?

---

1. Visual regression tests
1. Static analysis

---

# Visual regressions in the product

---

<Figure
    src={"/assets/chromatic-build.png"}
    alt="Chromatic Build"
    caption="Chromatic Build"
/>

---

# The process

1. Checkout the main branch of the product
1. Inject current branch of the design system
1. Run visual regressions tests

---

# Static analysis

---

## Why invest into infrastructure?

---

## Links and credits

- https://https://design-system.adverity.net
- https://https://design-system.adverity.net/playroom
- https://www.monolisa.dev ‚Äî the coding font I'm using

---

<Figure
  src={"/assets/component-driven.svg"}
  alt="Component-driven Logo"
  caption={
    <a href="https://www.component-driven.dev">www.component-driven.dev</a>
  }
/>

---

<Primary>

# Thank you!

<Grid gridGap={[3, 5]} columns={[1, 2]} pt={4}>
  <a href="https://twitter.com/okonetchnikov">@okonetchnikov</a>
  <a href="https://twitter.com/ComponentDriven">@ComponentDriven</a>
</Grid>

</Primary>
